<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lamumu Balloon Bash ðŸŽˆ</title>
  <style>
    :root{
      --bg:#f7f7fb; --ink:#222;
      --accent:#ff7aa2; --accent-2:#8fd3fe; --accent-3:#ffd36e;
      --time:#8bffb2; --good:#2ecc71; --bad:#ee5253;
      --stage-bg-image:none;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans";
      background:radial-gradient(circle at 20% 10%, #ffffff, var(--bg) 60%);
      color:var(--ink);overflow:hidden
    }
    .app{display:grid;grid-template-rows:auto 1fr auto;height:100dvh;max-width:960px;margin:0 auto;padding:12px clamp(12px,3vw,24px);gap:10px}
    header{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.2px}
    .badge{border:2px solid #000;background:#fff;border-radius:14px;padding:6px 10px;box-shadow:3px 3px 0 #000}
    .hud{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .pill{border:2px solid #000;background:#fff;border-radius:999px;padding:6px 12px;box-shadow:2px 2px 0 #000;min-width:110px;text-align:center;font-weight:700}
    #startBtn,.btn{appearance:none;border:2px solid #000;background:linear-gradient(180deg,#fff,#f2f2f2);border-radius:14px;padding:10px 14px;font-weight:800;cursor:pointer;box-shadow:3px 3px 0 #000;transition:transform .05s ease, box-shadow .05s ease}
    #startBtn:active,.btn:active{transform:translate(2px,2px);box-shadow:1px 1px 0 #000}

    .stage{
      position:relative;border:3px solid #000;background:linear-gradient(#d9f3ff 0%,#eaf7ff 40%,#fefcf7 100%);
      border-radius:18px;box-shadow:6px 6px 0 #00000020, inset 0 -60px 0 #f4f0e6;overflow:hidden
    }
    .stage::before{
      content:"";position:absolute;inset:0;background-image:var(--stage-bg-image);
      background-size:cover;background-position:center;opacity:.45;pointer-events:none
    }

    /* Zemin: ÅŸeritli ten rengi, Ã¶nde */
    .ground{
      position:absolute;inset:auto 0 0 0;height:120px;
      background:repeating-linear-gradient(90deg,#f7d6b3 0 18px,#eac29a 18px 36px);
      border-top:3px dashed #d2a679;
      z-index:5;
    }
    .fence{position:absolute;bottom:100px;left:-20px;right:-20px;height:24px;background:repeating-linear-gradient(90deg,#ffe0a6 0 40px,#ffd58a 40px 43px);box-shadow:0 4px 0 #cfa35b;z-index:4}

    /* Balon: %50 bÃ¼yÃ¼k, Ã§erÃ§evesiz; arkadan baÅŸlasÄ±n */
    .balloon{
      position:absolute;
      width:clamp(66px, 10.5vw, 105px);
      aspect-ratio:auto;
      border:none;border-radius:0;
      display:grid;place-items:center;cursor:crosshair;user-select:none;touch-action:none;
      filter:drop-shadow(2px 4px 0 #00000020);overflow:visible;
      z-index:1;
    }
    .balloon img{width:100%;height:auto;object-fit:contain;pointer-events:none}
    .balloon::after{display:none}
    .string{position:absolute;bottom:-38px;left:50%;width:2px;height:36px;background:#000;transform:translateX(-50%);z-index:1}

    /* Cow PNG ve Ã¼stte kalsÄ±n */
    .cow{position:absolute;left:10px;bottom:20px;display:grid;place-items:center;filter:drop-shadow(2px 4px 0 #00000020);transition:transform .12s ease; z-index:6}
    .cow img{display:block;width:clamp(150px,18vw,220px);height:auto}
    .cow .body,.cow .spot,.cow .face,.cow .eye,.cow .horn,.cow .ear{display:none !important}

    /* watermark */
    .watermark{
      position:absolute; right:14px; bottom:14px;
      padding:6px 10px; border:2px solid #000; border-radius:12px;
      background:#fff; font-weight:900; letter-spacing:.5px;
      box-shadow:3px 3px 0 #00000020; opacity:.95;
      user-select:none; pointer-events:none;
      z-index:10;
    }

    footer{font-size:12px;text-align:center;opacity:.7}
    a{color:inherit}
    .muted{opacity:.5}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand"><span class="badge">Lamumu</span> Balloon Bash ðŸŽˆ</div>
      <div class="hud">
        <div class="pill" id="score">Score: 0</div>
        <div class="pill" id="time">Time: 30</div>
        <button id="startBtn">Start Game</button>
        <button id="muteBtn" class="btn" title="Toggle sound">ðŸ”Š Sound</button>
      </div>
    </header>

    <main class="stage" id="stage" aria-label="Game stage" role="application">
      <div class="fence"></div>
      <div class="ground"></div>

      <!-- Cow (PNG) -->
      <div class="cow" id="cow" aria-hidden="true">
        <img id="cowImg" src="" alt="Lamumu cow" />
        <div class="body"></div> <!-- fallback gizli -->
      </div>

      <!-- Watermark -->
      <div class="watermark">rodruquez</div>
    </main>

    <footer>
      Common Ã— Lamumu â€” timed (+3s time balloons). Local assets are used by default; URL params can override them.
    </footer>
  </div>

  <script>
    // ---------- Elements
    const stage   = document.getElementById('stage');
    const scoreEl = document.getElementById('score');
    const timeEl  = document.getElementById('time');
    const startBtn= document.getElementById('startBtn');
    const muteBtn = document.getElementById('muteBtn');
    const cowImg  = document.getElementById('cowImg');

    // ---------- Assets (local defaults) + URL overrides
    const params = new URLSearchParams(location.search);
    const DEFAULTS = {
      bg:   'assets/bg.jpg',
      cow:  'assets/cow.png',
      skins:{
        normal:'assets/balloon_normal.png',
        time:  'assets/balloon_time.png',
        gold:  'assets/balloon_gold.png',
        bomb:  'assets/balloon_bomb.png'
      }
    };
    const overrides = {
      bg:   params.get('bg'),
      cow:  params.get('cow'),
      skins:{
        normal: params.get('balloon'),
        time:   params.get('balloon_time'),
        gold:   params.get('balloon_gold'),
        bomb:   params.get('balloon_bomb')
      }
    };
    const pick = (ov, def) => ov ? decodeURIComponent(ov) : def;

    // set background & cow
    const bgUrl = pick(overrides.bg, DEFAULTS.bg);
    if (bgUrl) document.documentElement.style.setProperty('--stage-bg-image', `url('${bgUrl}')`);
    const cowUrl = pick(overrides.cow, DEFAULTS.cow);
    if (cowUrl) cowImg.src = cowUrl;

    // balloon skins
    const skins = {
      normal: pick(overrides.skins.normal, DEFAULTS.skins.normal),
      time:   pick(overrides.skins.time,   DEFAULTS.skins.time),
      gold:   pick(overrides.skins.gold,   DEFAULTS.skins.gold),
      bomb:   pick(overrides.skins.bomb,   DEFAULTS.skins.bomb)
    };
    const imgFor = (type) => skins[type] || skins.normal || null;

    // ---------- State
    let score = 0, timeLeft = 30, running = false, spawnTimer = null, tickTimer = null;
    let muted = false;

    // ---------- SFX (dosya tabanlÄ±: moo & bomb; startâ€™ta otomatik Ã‡ALMA YOK)
    const SFX = {
      moo:   new Audio('assets/moo.mp3'),
      bomb:  new Audio('assets/bomb.mp3')
    };
    Object.values(SFX).forEach(a => { a.preload='auto'; a.volume=0.9; });
    function play(name){
      const a = SFX[name];
      if(!a || muted) return;
      try{ a.currentTime=0; a.play(); }catch{}
    }

    // kÃ¼Ã§Ã¼k synth "ding" (game over)
    let audioCtx=null;
    function ding(){
      if(muted) return;
      if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      const ctx=audioCtx, o=ctx.createOscillator(), g=ctx.createGain();
      o.type='sine'; o.frequency.setValueAtTime(880, ctx.currentTime);
      g.gain.setValueAtTime(0.0001, ctx.currentTime);
      o.connect(g).connect(ctx.destination);
      g.gain.exponentialRampToValueAtTime(0.3, ctx.currentTime+0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.25);
      o.start(); o.stop(ctx.currentTime+0.26);
    }

    // Mute sync
    muteBtn.addEventListener('click', ()=>{
      muted = !muted;
      Object.values(SFX).forEach(a => a.muted = muted);
      muteBtn.classList.toggle('muted', muted);
      muteBtn.textContent = muted ? 'ðŸ”‡ Muted' : 'ðŸ”Š Sound';
    });

    // ---------- Cow wiggle
    stage.addEventListener('pointermove', (e)=>{
      const r = stage.getBoundingClientRect();
      const x = (e.clientX-r.left)/r.width, y = (e.clientY-r.top)/r.height;
      document.getElementById('cow').style.transform = `translateY(${(0.5-y)*4}px) rotate(${(x-0.5)*6}deg)`;
    });

    // ---------- Game (hÄ±zlandÄ±rÄ±lmÄ±ÅŸ)
    const rand = (a,b)=> Math.random()*(b-a)+a;

    function createBalloon(){
      if(!running) return;
      const b = document.createElement('div'); b.className='balloon';

      // type
      const r = Math.random();
      if (r < 0.10)      b.dataset.type = 'time';
      else if (r < 0.22) b.dataset.type = 'gold';
      else if (r < 0.32) b.dataset.type = 'bomb';
      else               b.dataset.type = 'normal';

      // skin or color fallback
      const skin = imgFor(b.dataset.type);
      if (skin) {
        const img = document.createElement('img'); img.src = skin; img.alt = `${b.dataset.type} balloon`;
        b.appendChild(img);
      } else {
        const palette=['var(--accent)','var(--accent-2)','var(--accent-3)'];
        b.style.background=`radial-gradient(circle at 30% 30%, #fff8, currentColor 60%)`;
        if (b.dataset.type==='time') b.style.color = 'var(--time)';
        else if (b.dataset.type==='gold'){ b.style.color='gold'; b.style.filter='drop-shadow(0 0 8px #ffd700aa)'; }
        else if (b.dataset.type==='bomb'){ b.style.color='#333'; b.style.background='repeating-linear-gradient(45deg,#555 0 8px,#777 8px 16px)'; }
        else b.style.color = palette[Math.floor(Math.random()*palette.length)];
      }

      // zeminin altÄ±ndan baÅŸlat
      b.style.left = `calc(${rand(5,95)}% - 30px)`;
      const groundH = 120;
      const startBottom = -(groundH + 20);
      b.style.bottom = startBottom + 'px';

      const string=document.createElement('div'); string.className='string'; b.appendChild(string);
      b.addEventListener('pointerdown', ()=> popBalloon(b));
      stage.appendChild(b);

      // DAHA HIZLI yÃ¼kselsin (4â€“8 sn)
      const duration = rand(4,8), start = performance.now(), target = stage.clientHeight+120;
      function step(t){
        if(!running) return;
        const p = Math.min((t-start)/1000/duration,1);
        b.style.bottom = (startBottom + p*target) + 'px';
        if(p<1) requestAnimationFrame(step); else b.remove();
      }
      requestAnimationFrame(step);
    }

    function floatText(el, text, bg){
      const fx = document.createElement('div');
      fx.textContent = text; fx.style.position='absolute';
      fx.style.left = el.style.left; fx.style.bottom = el.style.bottom;
      fx.style.padding='2px 6px'; fx.style.fontWeight='800';
      fx.style.border='2px solid #000'; fx.style.borderRadius='10px';
      fx.style.background= bg || '#000'; fx.style.color='#fff';
      fx.style.transform='translate(-10px, -10px)'; fx.style.boxShadow='2px 2px 0 #000';
      stage.appendChild(fx);
      const t0 = performance.now();
      (function lift(t){ const p=Math.min((t-t0)/700,1); fx.style.opacity=String(1-p); fx.style.transform=`translate(-10px, ${-10 - p*34}px)`; if(p<1) requestAnimationFrame(lift); else fx.remove(); })(t0);
    }

    function popBalloon(b){
      if(!running) return;
      const type = b.dataset.type; b.classList.add('pop'); setTimeout(()=> b.remove(), 160);

      if(type==='bomb'){            // bomb â†’ bomb.mp3
        score = Math.max(0, score-3); floatText(b,'-3','var(--bad)'); play('bomb');
      } else if(type==='time'){     // time â†’ +3s + moo
        score += 1; timeLeft = Math.min(90, timeLeft+3); timeEl.textContent=`Time: ${Math.ceil(timeLeft)}`;
        floatText(b,'+3s','var(--time)'); play('moo');
      } else if(type==='gold'){     // gold â†’ +5 + moo
        score += 5; floatText(b,'+5','var(--good)'); play('moo');
      } else {                      // normal â†’ +1 + moo
        score += 1; floatText(b,'+1','var(--good)'); play('moo');
      }
      scoreEl.textContent = `Score: ${score}`;
      document.getElementById('cow').style.transform='translateY(-2px) scale(1.03)'; setTimeout(()=> document.getElementById('cow').style.transform='',120);
    }

    function startGame(){
      if(running) return; running=true; score=0; timeLeft=30;
      scoreEl.textContent='Score: 0'; timeEl.textContent='Time: 30';
      startBtn.textContent='Runningâ€¦'; startBtn.disabled=true;
      [...stage.querySelectorAll('.balloon')].forEach(el=>el.remove());

      // DAHA SIK spawn: base 450ms, minimum 160ms
      (function spawnLoop(){
        if(!running) return;
        createBalloon();
        const base=450;                               // 650 â†’ 450
        const accel=Math.max(160, base - (30 - Math.max(0,timeLeft))*12);
        spawnTimer=setTimeout(spawnLoop, accel);
      })();

      (function tick(){ if(!running) return; timeLeft=Math.max(0, timeLeft-0.2); timeEl.textContent=`Time: ${Math.ceil(timeLeft)}`; if(timeLeft>0){ tickTimer=setTimeout(tick,200);} else { endGame(); } })();
    }

    function endGame(){
      running=false; startBtn.disabled=false; startBtn.textContent='Play Again';
      clearTimeout(spawnTimer); clearTimeout(tickTimer);
      const dlg=document.createElement('div'); dlg.style.position='absolute'; dlg.style.inset='0'; dlg.style.display='grid'; dlg.style.placeItems='center'; dlg.style.background='rgba(255,255,255,.6)';
      const card=document.createElement('div'); card.style.border='3px solid #000'; card.style.background='#fff'; card.style.borderRadius='16px'; card.style.padding='18px 20px'; card.style.boxShadow='6px 6px 0 #00000020'; card.style.textAlign='center';
      card.innerHTML = `<h2 style="margin:6px 0 10px">Game Over!</h2><div style="font-weight:800; margin-bottom:8px">Your score: ${score}</div><button id="again" class="btn">Play Again</button>`;
      dlg.appendChild(card); stage.appendChild(dlg);
      card.querySelector('#again').addEventListener('click', ()=>{ dlg.remove(); startGame(); });
      ding(); // kÃ¼Ã§Ã¼k bitiÅŸ sesi
    }

    startBtn.addEventListener('click', startGame);
    window.addEventListener('keydown', e=>{ if((e.key===' '||e.key==='Enter') && !running) startGame(); });
  </script>
</body>
</html>
